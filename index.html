<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Floating GIF Demo</title>
<style>
  html, body {
    margin: 0;
    height: 200vh;
    font-family: Georgia, serif;
    background: linear-gradient(120deg, #f6f4ef, #e9edf1, #f3ede8);
    background-size: 300% 300%;
    animation: bgFlow 60s linear infinite;
  }

  @keyframes bgFlow {
    0% { background-position:0% 50%; }
    50% { background-position:100% 50%; }
    100% { background-position:0% 50%; }
  }

  .text {
    position: fixed;
    top: 2rem;
    left: 2rem;
    max-width: 300px;
    z-index: 1;
  }

  .ui {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    font-size: 18px;
    letter-spacing: 0.18em;
    color: rgba(60,60,60,0.65);
    z-index: 5;
  }

  .mail-gif {
    position: absolute;
    pointer-events: auto;
    opacity: 0;
    transform: translateY(20px) scale(0.95);
    transition: opacity 2.5s ease, transform 2.5s ease;
    z-index: 4;
  }

  .mail-gif.is-visible {
    opacity: 0.6;
    transform: translateY(0) scale(1);
  }

  /* PCサイズ */
  .mail-gif img {
    width: 420px;
    max-width: 70vw;
    height: auto;
    display: block;
  }

  /* モバイル */
  @media (max-width: 768px) {
    .mail-gif img {
      width: 40vw;
      max-width: 150px;
      height: auto;
    }

    .ui {
      font-size: 15px;
      bottom: 1.8rem;
      right: 1.5rem;
    }
  }
</style>
</head>
<body>

<div class="text">
  <p>ここは文章ブロックです。GIFはここに重ならないようにします。</p>
</div>

<div class="ui">EN | JP | DE</div>

<a href="mailto:n@natyama.com" class="mail-gif" aria-label="contact">
  <img src="svg/email-animation.gif" alt="contact mail">
</a>

<script>
const mailGif = document.querySelector('.mail-gif');

/* ランダム位置（文字ブロックを避ける） */
function randomPosition(el) {
  const vw = window.innerWidth;
  const vh = window.innerHeight;

  const rect = el.getBoundingClientRect();
  const w = rect.width || 300;
  const h = rect.height || 300;

  // 安全領域（左上のテキストを避ける）
  const safeLeft = 0;
  const safeTop = 100;  // pxで簡易
  const safeWidth = 320;
  const safeHeight = 150;

  const minX = safeLeft + safeWidth;
  const minY = safeTop + safeHeight;
  const maxX = Math.max(minX, vw - w);
  const maxY = Math.max(minY, vh - h);

  const x = minX + Math.random() * (maxX - minX);
  const y = minY + Math.random() * (maxY - minY);

  el.style.left = `${x}px`;
  el.style.top = `${y}px`;
}

/* フェードアウト→再配置→フェードイン */
function floatGif(el, interval=10000) {
  setInterval(() => {
    el.classList.remove('is-visible'); // フェードアウト
    setTimeout(() => {
      randomPosition(el);                // 再配置
      el.classList.add('is-visible');    // フェードイン
    }, 800);
  }, interval);
}

window.addEventListener('DOMContentLoaded', () => {
  randomPosition(mailGif);

  // 初期フェードイン
  setTimeout(() => mailGif.classList.add('is-visible'), 800);

  // 浮遊開始
  floatGif(mailGif, 11000);
});

window.addEventListener('resize', () => randomPosition(mailGif));
</script>

</body>
</html>
